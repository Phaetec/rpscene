{% extends 'base.html' %}
{% load static %}

{% block content %}
    <p>This is a test file, delete before production</p>
{% endblock %}

{% block extra_media %}
    <script src="{% static "node_modules/jshue/src/jshue.js" %}"></script>
    <script>
        $(document).ready(function () {
            let hue = jsHue();
            hue.discover().then(bridges => {
                if (bridges.length === 0) {
                    console.log('No bridges found. :(');
                } else {
                    bridges.forEach(b => console.log('Bridge found at IP address %s.', b.internalipaddress));
                    turn_on(bridges[0].internalipaddress);
                }
            }).catch(e => console.log('Error finding bridges', e));

            function turn_on(bridge_ip) {
                var bridge = hue.bridge(bridge_ip);

                // create user account (requires link button to be pressed)
                // TODO instruct the user to press the button to connect once
                //bridge.createUser('myApp#testdevice').then(data => {
                // extract bridge-generated username from returned data
                //    var username = data[0].success.username;

                //    console.log('New username:', username);
                // username: NG72PspgHAMDgtXVcD5m41v23iMwvygTpTDvqqqI
                // instantiate user object with username
                let user = bridge.user("NG72PspgHAMDgtXVcD5m41v23iMwvygTpTDvqqqI");
                user.getLights().then(lights => {
                    console.log(lights);
                });
                user.setLightState(2, {on: true}).then(data => {
                    console.log("light turned on, %s", data);
                })
            }
        })
    </script>
{% endblock %}